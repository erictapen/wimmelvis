<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Wimmel</title>
<style>

body {
	font-size: 15px;
	font-family: helvetica, sans-serif;	
	padding: 0; margin: 0;
	overflow: hidden;
}

h1 {
	position: fixed;
	top: 25px;
	left: 25px;
}

#info {
	position: absolute;
	left: 50%; top: 50%;
	transform:translate(-50%, -50%);
	width: 250px;
	min-height: 150px;
	background: #eee;
	padding: 0 1em;
	display: none;
}

#info.active { display: block; }

#map svg { height: 100vh; width: 100vw }

.object { opacity: 0; cursor: pointer;}
.object.active { opacity: 1;}

</style>
</head>

<h1>Find the object that has 3 sides!</h1>

<!-- this element shows the descriptions of the items -->
<div id="info"></div>

<!-- the svg is added to this element -->
<div id="map"></div>

<script>

// shortcuts to access elements
function x(s) { return document.querySelector(s); }
function X(s) { return document.querySelectorAll(s); }

// this variable will hold the metadata from the data file
var data = null;

// this variables is a reference to the DOM element holding the SVG elements 
var map = x('#map');

// load the SVG file and add its elements to the map
fetch('graphics.svg')
  .then(r => r.text())
  .then(text => { 
		map.innerHTML = text;		
		// initialize the map if data is loaded, too:
		if (data!=null) init();
	})

// load data file and add to data variable
fetch('data.json')
  .then(r => r.json())
	.then(d => {
		data = d;
		// initialize the map if svg is loaded, too:
		if (typeof x('#map svg') != "null") init();
	});


// add click events to all svg elements that have an entry in data file
function init() {
	
	// variable references the svg object
	var svg = x("#map svg");

	// iterate over all data items
	for (id in data) {
		
		var obj = svg.getElementById(id);
		
		// if id not found among svg elements issue warning and continue with loop
		if (obj == null) {
			console.warn(id+" not found in the map");
			continue;
		}
		
		// the object that is matched gets class object and is made invisible (see style above)
		obj.classList.add("object");
		
		// object gets a click event
		obj.onclick = function(){
			// reset all active classes from elements
			reset();
			
			// get id of the just clicked element
			var id = this.id;
			
			// the clicked element is activated and made visible (see style above)
			x("#"+id).classList.add("active");
			
			// this object's name and info is added to the info box
			x("#info").innerHTML = "<h2>"+ data[id].name +"</h2>" + "<p>" + data[id].info + "</p>";
			// the infobox is also made visible (see style above)
			x("#info").classList.add("active");
		}
	}
	
	// when clicking on the background, the selection is reset
	var bg = svg.getElementById("background")
	bg.onclick = function() { reset(); }
	
	// also when the escape key is pressed
	document.onkeyup = function(e) {
	   if (e.key === "Escape") {
			 reset();
		 }
	}	
	
}

// for now this just defaults to no object selected, later maybe moreâ€¦
function reset() {
	X(".active").forEach(el => el.classList.remove('active'));
}	

</script>
</html>